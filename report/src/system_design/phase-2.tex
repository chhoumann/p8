\section{Phase two: Presence classification}\label{sec:knn_implementation}
The \texttt{Data Handler} loads the data set from the JSON file and removes any duplicates to ensure data consistency.

To classify, the \texttt{Data Handler} calculates the distance between the current RSSI measurements and the collected RSSI data points.
These distances are then used to find the k-nearest neighbors.
Once the nearest neighbors are found, the weighted number of neighbors inside the room are calculated and compared to a threshold.
If the weighted number of neighbors inside the room is greater than this threshold, the resulting classification is \textit{inside} the room, and otherwise it is classified as \textit{outside} the room.
The classification algorithm can be seen in code snippet~\ref{lst:knn-implementation}.

\begin{figure}[H]
\begin{lstlisting}[
	language=CSharp, 
	frame=single, 
	label={lst:knn-implementation},
	escapeinside={(*}{*)},
	caption={C\# Implementation of the K-Nearest Neighbors Algorithm with Weighted Voting}, 
	captionpos=b] 
public ClassLabel Classify( (*\label{line:classify}*)
	int[] rssis, 
	IReadOnlyList<DataPoint> rssiDataPoints
) {
	DataPointDistance[] distances = CalculateDistances(
		rssis, 
		rssiDataPoints
	);

	DataPointDistance[] kNearestNeighbors = GetKNearestNeighbors( (*\label{line:GetKNearestNeighbors}*)
		distances,
		k
	);

	double weightedNumNeighborsInsideRoom = CalculateWeight( (*\label{line:weighted-num-neighbors-inside-room}*)
		kNearestNeighbors,
		ClassLabel.Inside
	);

	return weightedNumNeighborsInsideRoom > threshold 
		? ClassLabel.Inside 
		: ClassLabel.Outside;
}
\end{lstlisting}
\end{figure}

The \texttt{CalculateWeight} method, seen in code snippet~\ref{lst:knn-implementation} on line \ref{line:weighted-num-neighbors-inside-room}, calculates the weighted number of neighbors matching the provided target class label using the k-nearest neighbors. 
The \texttt{GetKNearestNeighbors} method on line \ref{line:GetKNearestNeighbors}, and the \texttt{CalculateWeight} method on line \ref{line:weighted-num-neighbors-inside-room}, are implementations of the approach described in Section~\ref{sec:phase2_classification}.

In the \texttt{Classify} method, as seen on line \ref{line:classify} in code snippet~\ref{lst:knn-implementation}, we use the resulting weight to determine whether the current point is inside or outside the room by comparing it to a threshold.
The threshold value can be adjusted to meet specific requirements for the application. A higher threshold will result in a stricter classification for \textit{inside} the room, while a lower threshold will make it more lenient.